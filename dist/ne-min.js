"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}window.ne={},window.ne.tools={},ne.tools.gl=function(){var e={};return e.textureFromCanvas=function(e,t){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),n},e}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Loader=function(){var e={audio:{},pixmaps:{},json:{},fonts:{}};return function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"loadPixmaps",value:function(t,n){return"undefined"==typeof e.pixmaps[t],this}},{key:"loadAudio",value:function(t,n){return"undefined"==typeof e.audio[t],this}},{key:"loadJson",value:function(t,n){return"undefined"==typeof e.json[t],this}},{key:"loadFont",value:function(t,n){return"undefined"==typeof e.fonts[t],this}},{key:"pixmap",value:function(e){}},{key:"audio",value:function(e){}},{key:"json",value:function(e){}},{key:"font",value:function(e){}}],[{key:"clear",value:function(){this.clearPixmaps(),this.clearAudio(),this.clearJson()}},{key:"clearPixmaps",value:function(){}},{key:"clearAudio",value:function(){}},{key:"clearJson",value:function(){}}]),t}()}();var _slicedToArray=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(r=(u=s.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(o){a=!0,i=o}finally{try{!r&&s["return"]&&s["return"]()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Color=function(){return function(){function e(t,n,r){var a=arguments.length<=3||void 0===arguments[3]?255:arguments[3];_classCallCheck(this,e),this.set(t,n,r,a)}return _createClass(e,[{key:"set",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?void 0:arguments[3];return"undefined"==typeof r&&(r=this.alpha),this.red=e,this.green=t,this.blue=n,this.alpha=r,this}},{key:"clone",value:function(){return new e(this.red,this.green,this.blue,this.alpha)}},{key:"toCss",value:function(){var e=this.alpha/255;return"rgba("+this.red+", "+this.green+", "+this.blue+", "+e+")"}},{key:"toArgb",value:function(){return this.alpha<<24+this.red<<16+this.green<<8+this.blue}},{key:"toRgba",value:function(){return this.red<<24+this.green<<16+this.blue<<8+this.alpha}},{key:"toRgb",value:function(){return this.red<<16+this.green<<8+this.blue}},{key:"toHsla",value:function(){var e,t,n=this.red/255,r=this.green/255,a=this.blue/255,i=Math.max(n,r,a),u=Math.min(n,r,a),s=(i+u)/2;if(i==u)e=t=0;else{var o=i-u;switch(t=s>.5?o/(2-i-u):o/(i+u),i){case n:e=(r-a)/o+(a>r?6:0);break;case r:e=(a-n)/o+2;break;case a:e=(n-r)/o+4}e/=6}return[e,t,s,this.alpha]}},{key:"toHsl",value:function(){var e,t,n=this.red/255,r=this.green/255,a=this.blue/255,i=Math.max(n,r,a),u=Math.min(n,r,a),s=(i+u)/2;if(i==u)e=t=0;else{var o=i-u;switch(t=s>.5?o/(2-i-u):o/(i+u),i){case n:e=(r-a)/o+(a>r?6:0);break;case r:e=(a-n)/o+2;break;case a:e=(n-r)/o+4}e/=6}return[e,t,s]}},{key:"grayscale",value:function(){var e=.21*this.red+.72*this.green+.07*this.blue;return this.set(e,e,e)}},{key:"average",value:function(){var e=(this.red+this.green+this.blue)/3;return this.set(e,e,e)}},{key:"lightnessAverage",value:function(){var e,t,n=[this.red,this.green,this.blue],r=((e=Math).max.apply(e,n)+(t=Math).min.apply(t,n))/2;return this.set(r,r,r)}},{key:"invert",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=e?255-this.alpha:this.alpha;return this.set(255-this.red,255-this.green,255-this.blue,t)}},{key:"red",get:function(){return this._r},set:function(e){this._r=Math.max(0,Math.min(255,e))}},{key:"green",get:function(){return this._g},set:function(e){this._g=Math.max(0,Math.min(255,e))}},{key:"blue",get:function(){return this._b},set:function(e){this._b=Math.max(0,Math.min(255,e))}},{key:"alpha",get:function(){return this._a},set:function(e){this._a=Math.max(0,Math.min(255,e))}},{key:"r",get:function(){return this.red},set:function(e){this.red=e}},{key:"g",get:function(){return this.green},set:function(e){this.green=e}},{key:"b",get:function(){return this.blue},set:function(e){this.blue=e}},{key:"a",get:function(){this.alpha},set:function(e){this.alpha=e}},{key:"hue",get:function(){return this.toHsl()[0]},set:function(t){var n=this.toHsla();n[0]=t;var r=e.fromHsla(n);this.set(r.red,r.green,r.blue,r.alpha)}},{key:"saturation",get:function(){return this.toHsl()[1]},set:function(t){var n=this.toHsla();n[1]=t;var r=e.fromHsla(n);this.set(r.red,r.green,r.blue,r.alpha)}},{key:"luminance",get:function(){return this.toHsl()[2]},set:function(t){var n=this.toHsla();n[2]=t;var r=e.fromHsla(n);this.set(r.red,r.green,r.blue,r.alpha)}},{key:"h",get:function(){return this.hue},set:function(e){this.hue=e}},{key:"s",get:function(){return this.saturation},set:function(e){this.saturation=e}},{key:"l",get:function(){return this.luminance},set:function(e){this.luminance=e}}],[{key:"_hue2rgb",value:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e}},{key:"_hslToRgb",value:function(t,n,r,a){var i,u,s;if(0==n)i=u=s=r;else{var o=.5>r?r*(1+n):r+n-r*n,l=2*r-o;i=this._hue2rgb(l,o,t+1/3),u=this._hue2rgb(l,o,t),s=this._hue2rgb(l,o,t-1/3)}return new e(Math.round(255*i),Math.round(255*u),Math.round(255*s),a)}},{key:"fromRgba",value:function(t){var n=t>>24&&255,r=t>>16&&255,a=t>>8&&255,i=t>>0&&255;return new e(n,r,a,i)}},{key:"fromRgb",value:function(t){var n=rgba>>16&&255,r=rgba>>8&&255,a=rgba>>0&&255;return new e(n,r,a)}},{key:"fromArgb",value:function(t){var n=rgba>>24&&255,r=rgba>>16&&255,a=rgba>>8&&255,i=rgba>>0&&255;return new e(r,a,i,n)}},{key:"fromHsla",value:function(e){var t=_slicedToArray(e,4),n=t[0],r=t[1],a=t[2],i=t[3];return this._hslToRgb(n,r,a,i)}},{key:"fromHsl",value:function(e){var t=_slicedToArray(e,3),n=t[0],r=t[1],a=t[2];return this._hslToRgb(n,r,a,255)}}]),e}()}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Pixmap=function(){return function(){function e(){arguments.length<=0||void 0===arguments[0]?1:arguments[0],arguments.length<=1||void 0===arguments[1]?1:arguments[1];_classCallCheck(this,e),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")}return _createClass(e,[{key:"_bltImage",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?void 0:arguments[3],a=arguments.length<=4||void 0===arguments[4]?void 0:arguments[4],i=arguments.length<=5||void 0===arguments[5]?0:arguments[5],u=arguments.length<=6||void 0===arguments[6]?0:arguments[6],s=arguments.length<=7||void 0===arguments[7]?void 0:arguments[7],o=arguments.length<=8||void 0===arguments[8]?void 0:arguments[8];return"undefined"==typeof r&&(r=e.width),"undefined"==typeof a&&(a=e.height),"undefined"==typeof s&&(s=r),"undefined"==typeof o&&(o=a),this._context.drawImage(e,t,n,r,a,i,u,s,o),this}},{key:"blt",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?void 0:arguments[3],a=arguments.length<=4||void 0===arguments[4]?void 0:arguments[4],i=arguments.length<=5||void 0===arguments[5]?0:arguments[5],u=arguments.length<=6||void 0===arguments[6]?0:arguments[6],s=arguments.length<=7||void 0===arguments[7]?void 0:arguments[7],o=arguments.length<=8||void 0===arguments[8]?void 0:arguments[8];return this._bltImage(e._canvas,t,n,r,a,i,u,s,o),this}},{key:"drawLine",value:function(e,t,n){}}],[{key:"fromImage",value:function(e){var t=new Pixmap(e.width,e.height);return t._bltImage(e,0,0,e.width,e.height),t}}]),e}()}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Drawable=function(){return function(){function e(){_classCallCheck(this,e),this._parent=null,this._events={},this.z=0}return _createClass(e,[{key:"render",value:function(e){}},{key:"act",value:function(e){}},{key:"fire",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this._ensureEventType(e);var n=!0,r=!0,a=!1,i=void 0;try{for(var u,s=this._events[e][Symbol.iterator]();!(r=(u=s.next()).done);r=!0){var o=u.value,l=o(t);"undefined"!=typeof l&&l===!1&&(n=!1)}}catch(h){a=!0,i=h}finally{try{!r&&s["return"]&&s["return"]()}finally{if(a)throw i}}return n}},{key:"on",value:function(e,t){this._ensureEventType(e),this._events[e].push(t)}},{key:"off",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if(null===t)return void(this._events[e]=[]);this._ensureEventType(e);var n=this._events[e].indexOf(t);-1!==n&&this._events[e].splice(n,1)}},{key:"_ensureEventType",value:function(e){"undefined"==typeof this._events[e]&&(this._events[e]=[])}},{key:"parent",get:function(){return this._parent}},{key:"z",get:function(){return this._z},set:function(e){this._z=e;var t=this.parent;t&&t.zUpdate()}}]),e}()}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Container=function(){return function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e._children=[],e._zRefresh=!1,e}return _inherits(t,e),_createClass(t,[{key:"act",value:function(e){this._refreshZ(),this._makeChildrenAct(e)}},{key:"render",value:function(e){this._renderChildren(e)}},{key:"zUpdate",value:function(){this._zRefresh=!0}},{key:"_refreshZ",value:function(){this._zRefresh&&(this.children.sort(function(e,t){return e.z-t.z}),this._zRefresh=!1)}},{key:"_makeChildrenAct",value:function(e){this.children.forEach(function(t){return t.act(e)})}},{key:"_renderChildren",value:function(e){this.children.forEach(function(t){return t.render(e)})}},{key:"add",value:function(e){this.contains(e)||(this.children.push(e),this.zUpdate())}},{key:"remove",value:function(e){var t=this.indexOf(e);-1!==t&&this.children.splice(t,1)}},{key:"indexOf",value:function(e){return this.children.indexOf(e)}},{key:"clear",value:function(){this.children=[]}},{key:"swap",value:function(e,t){var n=this.indexOf(e),r=this.indexOf(t);if(-1!==n&&-1!==r){var a=e.z;e.z=t.z,t.z=a}}},{key:"contains",value:function(e){return-1!==this.indexOf(e)}},{key:"children",get:function(){return this._children}}]),t}(ne.Drawable)}();