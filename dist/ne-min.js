"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}window.ne={},window.ne.tools={},ne.tools.gl=function(){var e={};return e.textureFromCanvas=function(e,t){var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),n},e.bindTexture=function(e,t){e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)},e.bindBuffer=function(e,t,n){e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)},e.draw=function(){gl.drawArrays(gl.TRIANGLES,0,6)},e.checkShader=function(e,t){var n=e.getShaderParameter(t,e.COMPILE_STATUS);if(!n){var r=e.getShaderInfoLog(t),i="Could not compile shader:"+r+".\nSource was:\n"+source;throw e.deleteShader(t),i}},e.makeShader=function(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),this.checkShader(e,r),r},e.checkProgram=function(e,t){var n=e.getProgramParameter(t,e.LINK_STATUS);if(!n)throw"program failed to link:"+e.getProgramInfoLog(t)},e.makeProgram=function(e,t,n){var r=e.createProgram();return e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),this.checkProgram(e,r),r},e}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Loader=function(){var e={audio:{},pixmaps:{},json:{},fonts:{}};return function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"loadPixmaps",value:function(t,n){return"undefined"==typeof e.pixmaps[t],this}},{key:"loadAudio",value:function(t,n){return"undefined"==typeof e.audio[t],this}},{key:"loadJson",value:function(t,n){return"undefined"==typeof e.json[t],this}},{key:"loadFont",value:function(t,n){return"undefined"==typeof e.fonts[t],this}},{key:"pixmap",value:function(e){}},{key:"audio",value:function(e){}},{key:"json",value:function(e){}},{key:"font",value:function(e){}}],[{key:"clear",value:function(){this.clearPixmaps(),this.clearAudio(),this.clearJson()}},{key:"clearPixmaps",value:function(){}},{key:"clearAudio",value:function(){}},{key:"clearJson",value:function(){}}]),t}()}(),ne.tools.defineEscalarPorperties=function(){function e(e){function t(e,r){for(var i,r=r||[],a=0;a<e.length;a++)i=e.splice(a,1),0===e.length&&n.push(r.concat(i)),t(e.slice(),r.concat(i)),e.splice(a,0,i[0]);return n}var n=[];return t(e)}function t(e){return{get:function(){var t=this;return e.map(function(e){return t[e]})},set:function(t){var n=this;e.forEach(function(e,r){return n[e]=t[r]})},configurable:!0}}function n(e,n,r){n.forEach(function(n){var i=n.slice(0,r+1),a=i.join("");"undefined"==typeof e[a]&&(e[a]=t(i))})}function r(t){for(var r={},i=e(t),a=1;a<=t.length;++a)n(r,i,a);return r}return function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;t>i;i++)n[i-1]=arguments[i];Object.defineProperties(e,r(n))}}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Point=function(){return function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];_classCallCheck(this,e),this.x=t,this.y=n,this.z=r}return _createClass(e,[{key:"set",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?void 0:arguments[2];this.x=e,this.y=t,this.z="undefined"==typeof n?n:this.z}},{key:"dimensions",get:function(){return null===z?2:3}}]),e}()}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Rect=function(){var e=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2],i=arguments.length<=3||void 0===arguments[3]?0:arguments[3];_classCallCheck(this,e),this.set(t,n,r,i)}return _createClass(e,[{key:"set",value:function(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r}},{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"topLeft",get:function(){var e=this;return{get x(){return e.x},get y(){return e.y}}}},{key:"w",get:function(){return this.width},set:function(e){this.width=e}},{key:"h",get:function(){return this.height},set:function(e){this.height=e}},{key:"topRight",get:function(){var e=this;return{get x(){return e.x+e.width},get y(){return e.y}}}},{key:"bottomLeft",get:function(){var e=this;return{get x(){return e.x},get y(){return e.y+e.height}}}},{key:"bottomRight",get:function(){var e=this;return{get x(){return e.x+e.width},get y(){return e.y+e.height}}}}]),e}();return ne.tools.defineEscalarPorperties(e.prototype,"x","y","w","h"),e}();var _slicedToArray=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var u,o=e[Symbol.iterator]();!(r=(u=o.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(s){i=!0,a=s}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Color=function(){var e=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2],i=arguments.length<=3||void 0===arguments[3]?255:arguments[3];_classCallCheck(this,e),this.set(t,n,r,i)}return _createClass(e,[{key:"set",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?void 0:arguments[3];return"undefined"==typeof r&&(r=this.alpha),this.red=e,this.green=t,this.blue=n,this.alpha=r,this}},{key:"clone",value:function(){return new e(this.red,this.green,this.blue,this.alpha)}},{key:"toCss",value:function(){var e=this.alpha/255;return"rgba("+this.red+", "+this.green+", "+this.blue+", "+e+")"}},{key:"toArgb",value:function(){return this.alpha<<24+this.red<<16+this.green<<8+this.blue}},{key:"toRgba",value:function(){return this.red<<24+this.green<<16+this.blue<<8+this.alpha}},{key:"toRgb",value:function(){return this.red<<16+this.green<<8+this.blue}},{key:"toHsla",value:function(){var e,t,n=this.red/255,r=this.green/255,i=this.blue/255,a=Math.max(n,r,i),u=Math.min(n,r,i),o=(a+u)/2;if(a==u)e=t=0;else{var s=a-u;switch(t=o>.5?s/(2-a-u):s/(a+u),a){case n:e=(r-i)/s+(i>r?6:0);break;case r:e=(i-n)/s+2;break;case i:e=(n-r)/s+4}e/=6}return[e,t,o,this.alpha]}},{key:"toHsl",value:function(){var e,t,n=this.red/255,r=this.green/255,i=this.blue/255,a=Math.max(n,r,i),u=Math.min(n,r,i),o=(a+u)/2;if(a==u)e=t=0;else{var s=a-u;switch(t=o>.5?s/(2-a-u):s/(a+u),a){case n:e=(r-i)/s+(i>r?6:0);break;case r:e=(i-n)/s+2;break;case i:e=(n-r)/s+4}e/=6}return[e,t,o]}},{key:"grayscale",value:function(){var e=.21*this.red+.72*this.green+.07*this.blue;return this.set(e,e,e)}},{key:"average",value:function(){var e=(this.red+this.green+this.blue)/3;return this.set(e,e,e)}},{key:"lightnessAverage",value:function(){var e,t,n=[this.red,this.green,this.blue],r=((e=Math).max.apply(e,n)+(t=Math).min.apply(t,n))/2;return this.set(r,r,r)}},{key:"invert",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=e?255-this.alpha:this.alpha;return this.set(255-this.red,255-this.green,255-this.blue,t)}},{key:"red",get:function(){return this._r},set:function(e){this._r=Math.max(0,Math.min(255,e))}},{key:"green",get:function(){return this._g},set:function(e){this._g=Math.max(0,Math.min(255,e))}},{key:"blue",get:function(){return this._b},set:function(e){this._b=Math.max(0,Math.min(255,e))}},{key:"alpha",get:function(){return this._a},set:function(e){this._a=Math.max(0,Math.min(255,e))}},{key:"r",get:function(){return this.red},set:function(e){this.red=e}},{key:"g",get:function(){return this.green},set:function(e){this.green=e}},{key:"b",get:function(){return this.blue},set:function(e){this.blue=e}},{key:"a",get:function(){return this.alpha},set:function(e){this.alpha=e}},{key:"hue",get:function(){return this.toHsl()[0]},set:function(t){var n=this.toHsla();n[0]=t;var r=e.fromHsla(n);this.set(r.red,r.green,r.blue,r.alpha)}},{key:"saturation",get:function(){return this.toHsl()[1]},set:function(t){var n=this.toHsla();n[1]=t;var r=e.fromHsla(n);this.set(r.red,r.green,r.blue,r.alpha)}},{key:"luminance",get:function(){return this.toHsl()[2]},set:function(t){var n=this.toHsla();n[2]=t;var r=e.fromHsla(n);this.set(r.red,r.green,r.blue,r.alpha)}},{key:"h",get:function(){return this.hue},set:function(e){this.hue=e}},{key:"s",get:function(){return this.saturation},set:function(e){this.saturation=e}},{key:"l",get:function(){return this.luminance},set:function(e){this.luminance=e}}],[{key:"_hue2rgb",value:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e}},{key:"_hslToRgb",value:function(t,n,r,i){var a,u,o;if(0==n)a=u=o=r;else{var s=.5>r?r*(1+n):r+n-r*n,c=2*r-s;a=this._hue2rgb(c,s,t+1/3),u=this._hue2rgb(c,s,t),o=this._hue2rgb(c,s,t-1/3)}return new e(Math.round(255*a),Math.round(255*u),Math.round(255*o),i)}},{key:"fromRgba",value:function(t){var n=t>>24&&255,r=t>>16&&255,i=t>>8&&255,a=t>>0&&255;return new e(n,r,i,a)}},{key:"fromRgb",value:function(t){var n=rgba>>16&&255,r=rgba>>8&&255,i=rgba>>0&&255;return new e(n,r,i)}},{key:"fromArgb",value:function(t){var n=rgba>>24&&255,r=rgba>>16&&255,i=rgba>>8&&255,a=rgba>>0&&255;return new e(r,i,a,n)}},{key:"fromHsla",value:function(e){var t=_slicedToArray(e,4),n=t[0],r=t[1],i=t[2],a=t[3];return this._hslToRgb(n,r,i,a)}},{key:"fromHsl",value:function(e){var t=_slicedToArray(e,3),n=t[0],r=t[1],i=t[2];return this._hslToRgb(n,r,i,255)}}]),e}();return ne.tools.defineEscalarPorperties(e.prototype,"r","g","b","a"),ne.tools.defineEscalarPorperties(e.prototype,"h","l","s","a"),e}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.ShaderBase=function(){var e=function(){function e(){_classCallCheck(this,e),this.initMembers()}return _createClass(e,[{key:"initMembers",value:function(){this._glProgram=null,this._glVertex=null,this._glFragment=null,this._glAttributes={},this._glUniforms={}}},{key:"vertex",value:function(){return""}},{key:"fragment",value:function(){return""}},{key:"attributes",value:function(){return{}}},{key:"uniforms",value:function(){return{}}},{key:"varying",value:function(){return{}}},{key:"generate",value:function(e){return this._glProgram||(this.generateVertexShader(e),this.generateFragmentShader(e),this.generateProgram(e),this.generateVariables(e)),this._glProgram}},{key:"use",value:function(e){e.useProgram(this._glProgram)}},{key:"generateVariables",value:function(e){this.generateAttributes(e),this.generateUniforms(e)}},{key:"generateAttributes",value:function(e){var t=this,n=this.attributes();Object.keys(n).forEach(function(n){t._glAttributes[n]=e.getAttribLocation(t._glProgram,n)})}},{key:"generateUniforms",value:function(e){var t=this,n=this.attributes();Object.keys(n).forEach(function(n){t._glUniforms[n]=e.getUniformLocation(t._glProgram,n)})}},{key:"destroy",value:function(e){this.destroyVertexShader(e),this.destroyFragmentShader(e),this.destroyProgram(e)}},{key:"destroyVertexShader",value:function(e){this._glVertex&&(this._glProgram&&(e.detachShader(this._glProgram,this._glVertex),e.destroyShader(this._glVertex)),this._glVertex=null)}},{key:"destroyFragmentShader",value:function(e){this._glFragment&&(this._glProgram&&(e.detachShader(this._glProgram,this._glFragment),e.destroyShader(this._glFragment)),this._glVertex=null)}},{key:"destroyProgram",value:function(e){this._glProgram&&(e.destroyProgram(this._glProgram),this._glProgram=null)}},{key:"generateVertexShader",value:function(e){try{this._glVertex=ne.tools.gl.makeShader(e,e.VERTEX_SHADER,this.vertexSource())}catch(t){throw this.destroy(e),t}}},{key:"generateFragmentShader",value:function(e){try{this._glFragment=ne.tools.gl.makeShader(e,e.FRAGMENT_SHADER,this.fragmentSource())}catch(t){throw this.destroy(e),t}}},{key:"vertexSource",value:function(){return this.vertexHeader()+this.mainFunction(this.vertex())}},{key:"fragmentSource",value:function(){return this.fragmentHeader()+this.mainFunction(this.fragment())}},{key:"generateProgram",value:function(e){try{this._glProgram=ne.tools.gl.generateProgram(e,this._glVertex,this._glFragment)}catch(t){throw this.destroy(e),t}}},{key:"vertexHeader",value:function(){return this.precision()+this.attributeSource()+this.uniformSource()+this.varyingSource()}},{key:"fragmentHeader",value:function(){return this.precision()+this.uniformSource()+this.varyingSource()}},{key:"sourceFromObject",value:function(e,t){var n="";for(var r in t)if(t.hasOwnProperty(r)){var i=this.glType(t[r]);n+=e+" "+i+" "+r+";"}return n}},{key:"updateAttributes",value:function(e){var t=this;Object.keys(this._glAttributes).forEach(function(n){t.updateAttribute(e,n)})}},{key:"updateAttribute",value:function(e,t){var n=this._glAttributes[t];n&&(e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0))}},{key:"attributeSource",value:function(){return this.sourceFromObject("attribute",this.attributes())}},{key:"uniformSource",value:function(){return this.sourceFromObject("uniform",this.uniforms())}},{key:"varyingSource",value:function(){return this.sourceFromObject("varying",this.varying())}},{key:"precision",value:function(){return"precision mediump float;"}},{key:"mainFunction",value:function(e){return"void main(void) { "+e+" }"}},{key:"glType",value:function(t){return e.TYPES[t]}}]),e}();return e.TYPES={point:"vec2","3d-point":"vec3",color:"vec4",number:"float",array:"vec4",real:"real",rect:"vec4",vec2:"vec2",vec3:"vec3",vec4:"vec4","float":"float","int":"int"},e}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_get=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var u=i.get;return void 0===u?void 0:u.call(r)};ne.Shader=function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this))}return _inherits(t,e),_createClass(t,[{key:"initMembers",value:function(){_get(Object.getPrototypeOf(t.prototype),"initMembers",this).call(this),this._values=this._defaultSet(this.uniforms())}},{key:"_defaultSet",value:function(e){var t=this,n={};return Object.keys(e).forEach(function(r){n[r]=t._getDefaultValue(e[r])}),n}},{key:"_getDefaultValue",value:function(e){switch(e){case"point":return new ne.Point(0,0);case"3d-point":return new ne.Point(0,0,0);case"color":return new ne.Color(0,0,0);case"rect":return new ne.Rect;case"number":case"float":case"real":return 0;case"vec2":return[0,0];case"vec3":return[0,0,0];case"array":case"vec4":return[0,0,0,0];default:return 0}}},{key:"update",value:function(e){this.updateUniforms(e)}},{key:"updateUniforms",value:function(e){var t=this,n=this.uniformValues,r=this.uniforms();Object.keys(n).forEach(function(i){t.updateUniform(e,i,r[i],n[i])})}},{key:"updateUniform",value:function(e,t,n,r){var i=this._glUniforms[t];i&&this.updateUniformByType(e,i,n,r)}},{key:"updateUniformByType",value:function(e,t,n,r){switch(n){case"float":case"number":case"real":e.uniform1f(t,r);break;case"vec2":e.uniform2f(t,r[0],r[1]);break;case"vec3":e.uniform3f(t,r[0],r[1],r[2]);break;case"vec4":e.uniform4f(t,r[0],r[1],r[2],r[3]);break;case"rect":e.uniform4f(t,rect.x,rect.y,rect.width,rect.height);break;case"color":e.uniform4f(t,color.red,color.green,color.blue,color.alpha)}}},{key:"uniformValues",get:function(){return this._values}}]),t}(ne.ShaderBase)}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Texture=function(){return function(){function e(t){_classCallCheck(this,e),this._data=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._pixmap=t,this._glTexture=null,this._buffer=null,this._isDirty=!1}return _createClass(e,[{key:"generate",value:function(e){return this._isDirty&&(this._isDirty=!1,this.destroyTexture()),this.regenerateTexture(e),this.regenerateBuffer(e),this._glTexture}},{key:"update",value:function(){this._isDirty=!0}},{key:"regenerateTexture",value:function(e){this._glTexture||this.generateTexture(e)}},{key:"regenerateBuffer",value:function(e){this._buffer||this.generateBuffer(e)}},{key:"destroy",value:function(e){this.destroyTexture(e),this.destroyBuffer(e)}},{key:"destroyTexture",value:function(e){this._glTexture&&(e.destroyTexture(e),this._glTexture=null)}},{key:"destroyBuffer",value:function(e){this._buffer&&(e.destroyBuffer(this._buffer),this._buffer=null)}},{key:"generateBuffer",value:function(e){this._buffer=e.createBuffer()}},{key:"generateTexture",value:function(e){this._glTexture=this._pixmap.generateTexture(e)}},{key:"bind",value:function(e,t){this.bindBuffer(e,t),this.bindTexture(e)}},{key:"bindBuffer",value:function(e,t){this.refreshData(t),ne.tools.gl.bindBuffer(e,this._buffer,this._data)}},{key:"refreshData",value:function(e){var t=this.clamp(e.x/this._pixmap.width),n=this.clamp(e.y/this._pixmap.height),r=this.clamp((e.x+e.width)/this._pixmap.width),i=this.clamp((e.y+e.height)/this._pixmap.height);this._data[0]=this._data[4]=this._data[6]=t,this._data[1]=this._data[3]=this._data[9]=n,this._data[2]=this._data[8]=this._data[10]=r,this._data[5]=this._data[7]=this._data[11]=i}},{key:"clamp",value:function(e){return Math.max(0,Math.min(1,e))}},{key:"bindTexture",value:function(e){ne.tools.gl.bindTexture(e,this._glTexture)}}]),e}()}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Pixmap=function(){return function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],n=arguments.length<=1||void 0===arguments[1]?1:arguments[1];_classCallCheck(this,e),this._canvas=document.createElement("canvas"),this._canvas.width=t,this._canvas.height=n,this._context=this._canvas.getContext("2d")}return _createClass(e,[{key:"_bltImage",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?void 0:arguments[3],i=arguments.length<=4||void 0===arguments[4]?void 0:arguments[4],a=arguments.length<=5||void 0===arguments[5]?0:arguments[5],u=arguments.length<=6||void 0===arguments[6]?0:arguments[6],o=arguments.length<=7||void 0===arguments[7]?void 0:arguments[7],s=arguments.length<=8||void 0===arguments[8]?void 0:arguments[8];return"undefined"==typeof r&&(r=e.width),"undefined"==typeof i&&(i=e.height),"undefined"==typeof o&&(o=r),"undefined"==typeof s&&(s=i),this._context.drawImage(e,t,n,r,i,a,u,o,s),this}},{key:"blt",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?void 0:arguments[3],i=arguments.length<=4||void 0===arguments[4]?void 0:arguments[4],a=arguments.length<=5||void 0===arguments[5]?0:arguments[5],u=arguments.length<=6||void 0===arguments[6]?0:arguments[6],o=arguments.length<=7||void 0===arguments[7]?void 0:arguments[7],s=arguments.length<=8||void 0===arguments[8]?void 0:arguments[8];return this._bltImage(e._canvas,t,n,r,i,a,u,o,s),this}},{key:"drawLine",value:function(e,t,n){}},{key:"generateTexture",value:function(e){return ne.tools.gl.textureFromCanvas(e,this._canvas)}},{key:"width",get:function(){return this._canvas.width}},{key:"height",get:function(){return this._canvas.height}}],[{key:"fromImage",value:function(t){var n=new e(t.width,t.height);return n._bltImage(t,0,0,t.width,t.height),n}}]),e}()}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Drawable=function(){return function(){function e(){_classCallCheck(this,e),this._parent=null,this._events={},this.z=0}return _createClass(e,[{key:"render",value:function(e){}},{key:"act",value:function(e){}},{key:"fire",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this._ensureEventType(e);var n=!0,r=!0,i=!1,a=void 0;try{for(var u,o=this._events[e][Symbol.iterator]();!(r=(u=o.next()).done);r=!0){var s=u.value,c=s(t);"undefined"!=typeof c&&c===!1&&(n=!1)}}catch(l){i=!0,a=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw a}}return n}},{key:"on",value:function(e,t){this._ensureEventType(e),this._events[e].push(t)}},{key:"off",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if(null===t)return void(this._events[e]=[]);this._ensureEventType(e);var n=this._events[e].indexOf(t);-1!==n&&this._events[e].splice(n,1)}},{key:"_ensureEventType",value:function(e){"undefined"==typeof this._events[e]&&(this._events[e]=[])}},{key:"parent",get:function(){return this._parent}},{key:"z",get:function(){return this._z},set:function(e){this._z=e;var t=this.parent;t&&t.zUpdate()}}]),e}()}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.Container=function(){return function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e._children=[],e._zRefresh=!1,e}return _inherits(t,e),_createClass(t,[{key:"act",value:function(e){this._refreshZ(),this._makeChildrenAct(e)}},{key:"render",value:function(e){this._renderChildren(e)}},{key:"zUpdate",value:function(){this._zRefresh=!0}},{key:"_refreshZ",value:function(){this._zRefresh&&(this.children.sort(function(e,t){return e.z-t.z}),this._zRefresh=!1)}},{key:"_makeChildrenAct",value:function(e){this.children.forEach(function(t){return t.act(e)})}},{key:"_renderChildren",value:function(e){this.children.forEach(function(t){return t.render(e)})}},{key:"add",value:function(e){this.contains(e)||(this.children.push(e),this.zUpdate())}},{key:"remove",value:function(e){var t=this.indexOf(e);-1!==t&&this.children.splice(t,1)}},{key:"indexOf",value:function(e){return this.children.indexOf(e)}},{key:"clear",value:function(){this.children=[]}},{key:"swap",value:function(e,t){var n=this.indexOf(e),r=this.indexOf(t);if(-1!==n&&-1!==r){var i=e.z;e.z=t.z,t.z=i}}},{key:"contains",value:function(e){return-1!==this.indexOf(e)}},{key:"children",get:function(){return this._children}}]),t}(ne.Drawable)}(),ne.Sprite=function(){return function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.position=new ne.Point,e.scale=new ne.Point(1,1),e.offset=new ne.Point,e.shader=new ne.SpriteShader,e}return _inherits(t,e),t}(ne.Drawable)}();var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();ne.SpriteShader=function(){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"vertex",value:function(){return"gl_Position = vec4(a_position, 0, 1);"}},{key:"fragment",value:function(){return"gl_FragColor = vec4(0, 1, 0, 1);"}},{key:"attributes",value:function(){return{a_position:"vec2"}}},{key:"uniforms",value:function(){return{}}},{key:"varying",value:function(){return{}}}]),t}(ne.Shader)}();